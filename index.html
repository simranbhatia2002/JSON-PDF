<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat Export</title>
    <script>
      async function fetchChats() {
        const response = await fetch("/chats");
        const chats = await response.json();
        const container = document.getElementById("chatList");

        container.innerHTML = "";
        chats.forEach((chat) => {
          const div = document.createElement("div");
          div.innerHTML = `
                    <input type="checkbox" value="${chat.filename}">
                    <label>${chat.displayName}</label>
                    <a href="/download/${chat.filename}" target="_blank">Download</a>
                `;
          container.appendChild(div);
        });
      }

      async function exportSelectedChats() {
        const checkboxes = document.querySelectorAll(
          "input[type=checkbox]:checked"
        );
        checkboxes.forEach((cb) => {
          window.open(`/download/${cb.value}`);
        });
      }

      document.addEventListener("DOMContentLoaded", fetchChats);
    </script>
  </head>
  <body>
    <h2>Select Chats to Export</h2>
    <div id="chatList"></div>
    <button onclick="exportSelectedChats()">Export Selected Chats</button>
  </body>
</html>
